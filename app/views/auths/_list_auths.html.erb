<table class="auths">
  <caption><%= caption ||= 'Auths' %></caption>
  <thead>
    <tr>
      <th>Patient</th>
      <th class="qty">Allowed sessions</th>
      <th class="qty">Used sessions</th>
      <th class="price">Amount</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% auths.sort.each do |auth| %>
      <tr>
	<td><%= auth.patient.select_name %>
	<td class='qty'><%= auth.max_sessions %></td>
	<td class='qty'><%= auth.bill_items.maximum(:quantity) %></td>
	<td class='price'><%= number_to_currency auth.bill_items.sum(:total) %></td>
	<td class='link'><%= link_to 'Detail', auth_path(auth) %></td>
	<td class='link'><%= link_to 'Edit', edit_auth_path(auth) %></td>
	<td class='link'><%= link_to 'Delete', auth_path(auth), :confirm => 'Are you sure?', :method => :delete %></td>
      </tr>
    <% end -%>
    <tr class='totals'>
      <td class='totals'>Totals</td>
      <td class='totals qty'><%= auths.map(&:max_sessions).sum %></td>
      <td class='totals qty'><%= auths.map(&:maximum_quantity).sum %></td>
      <td class="totals price"><%= number_to_currency auths.map(&:total).sum %></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
